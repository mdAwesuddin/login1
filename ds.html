<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://kit.fontawesome.com/2ce8bca9b1.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
    <title>Home</title>
    <style>
        .Home-main{
        display: flex;
        }
        .Home-link{
        text-decoration: none;
        color: white;
        /* padding-right: 15px; */
      }
      .Home-link-active{
       border-bottom: 1px solid white; /* Highlight color for the active link */
        color: #fff;
      }
      .useradd{
        padding: 8px;
        font-size: 15px;
        border-radius: 8px;
        cursor: pointer;
      }
      .useradd:hover{
        background-color: aqua;
      }
      .image-preview {
        text-align: center;
      }
      #image-upload {
          display: block; 
         display: block; 
         margin: auto;
         /* text-align: center;
         margin: auto;
         position: absolute;
         top: 72%; */
      }
      #preview-image {
          max-width: 100%;
          max-height: 300px;
          margin-top: 10px;
          display: none; /* Initially hide the image preview */
          width: 50%; 
          margin: auto;
      }
      #fname-field, #lname-field, #mail-field, #num-field{
        padding: 5px;
        font-size: 16px;
        border-radius: 8px;
      }
      #image8{
        width: 250px;
      }
        table {
        width: 100%;
        /* border: 1px solid black; */
        border-collapse: collapse;
        margin: 0;
        /* box-shadow: 0 0 5px rgba(0, 0, 0, .25); */
      }
      table tr{
        padding: .45em;
      }
      tr th{
        background-color: #6e0737;
      }
      tbody tr:nth-child(even){
        background-color: #eaeaea;
      }
      table th,
      table td{
        font-size: 1em;
        padding: 1em;
        text-align: center;
      }
        th{
        color: #fff;
        font-size: 1.15em;
      }
      #error-msg, #error-msg1, #error-msg2, #error-msg3, #error-msg4{
        font-size: 12px;
      }
      @media (max-width:500px){
        /* table{
          border: 3px solid #6e0737;
        } */
        table  tr th{
          display: none;
        }
        table tr{
          display: block;
        }
        table th,table td{
          padding: .5em;
        }
        table td{
          text-align: right;
          display: block;
          font-size: 1em;
        }
        table td::before{
          content: attr(data-title)":";
          float: left;
          font-weight: 600;
        };
        tbody tr:nth-child(even){
          background-color: #6e0737;
          color: #fff;
        }
      }
      .btn1.unactive{
        display: none;
      }
      .btn2{
        display: none;
      }
      .btn2.active{
        display:block;
      }
      .btn2-class{
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #edit-btn{
        padding: 5px;
        width: 50px;
        cursor: pointer;
        border-radius: 5px;
        background-color: lightgreen;
      }
      #delete-btn{
        padding: 5px;
        width: 50px;
        cursor: pointer;
        border-radius: 5px;
        background-color: red;
        color: white;
        font-weight: 500;
      }
      .highlight {
        color: darkgoldenrod;
        font-weight: bold;
        /* background-color: yellow; */
        }
        #searchInput{
          border-radius: 10px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <h3 class="logo">LOGO</h3>
        <div class="Home-main">
            <a class="Home-link" href="ds.html">Home</a>
        <div class="dropdown">
        <button class="dropbtn"><i class="fa-solid fa-user"></i><span class="user">Awesuddin</span><i class="fa fa-caret-down"></i></button>
            <div class="dropdown-content">
                <a href="profile.html"><i class="fa-solid fa-user" style="padding-right: 5px;"></i>Profile</a>
                <a href="change-password.html"><i class="fa-solid fa-lock" style="padding-right: 5px;"></i>Change Password</a>
                <a href="index.html"><i class="fa-solid fa-right-from-bracket" style="padding-right: 5px;"></i>Logout</a>
            </div>
        </div>
        </div>
    </nav>
    <div class="content">
      <input type="text" id="searchInput" placeholder="Search..." >
        <input type="button" value="Add-User" class="useradd" onclick="validation(event)">
    </div>
    <div class="data">
        <br>
        <table id='data2'>
          <!-- <tr id="tr">
            <th>Profile</th>
            <th>Frist Name</th>
            <th>Last Name</th>
            <th>E-mail</th>
            <th>Mobile Number</th>
            <th>Actions</th>
        </tr> -->  
        </table>
        <form id="user-form">
        <div class="popup">
            <div class="head">
              <div class="icon">
                <div class="btn">
                  <button class="close-btn">&times;</button>
                   </div>
                <div class="box">
                <div class="row">
                    <input type="text" placeholder="FirstName" id="fname-field" oninput="firstnamevalid(event)">
                    <br>
                    <span id="error-msg"></span>
                  </div>
                  <div class="row">
                    <input type="text" placeholder="LastName" id="lname-field" oninput="lastnamevalid(event)">
                    <br>
                    <span id="error-msg1"></span>
                  </div>
                  <div class="row">
                    <input type="email" placeholder="Email" id="mail-field" oninput="emailvalid(event)">
                    <br>
                    <span id="error-msg2"></span>
                  </div> 
                  <div class="row">
                    <input type="num" placeholder="Phone" id="num-field" oninput="phone(event)">
                    <br>
                    <span id="error-msg3"></span>
                  </div>  
                  <div class="row">
                    <img src="preview-image" alt="Image Preview" id="preview-image"><br>
                    
                    <input type="file" id="image-upload" accept="image/*" required>
                    <span id="error-msg4"></span>
                    <br>
                  </div>  
                  <input type="button" value="Add-User" class="btn1" > 
                  <div class="btn2-class">       
                  <input type="button" value="Update" class="btn2" onclick="updatedata()" >  
                  </div>        
                  </div>
              </div>
            </div>
          </form>
            <!-- <div class="body">
              
            </div> -->
          </div>
    </div>
    <div id="noDataFound" style="display: none;">No data found.</div>
    <script>
      const images=[]

      var firstname = document.getElementById("fname-field")
      const lastname = document.getElementById("lname-field");
      const mail = document.getElementById("mail-field")
      const num = document.getElementById("num-field")
      const submit=document.getElementsByClassName("btn1")[0];
      let imageUpload = document.getElementById('image-upload');
      let previewImage = document.getElementById('preview-image');
      let previewImage1 = document.getElementById('preview-image1');
      const imageu=document.getElementById("image8")
      let databody = document.getElementById("data2");
      
      let cardImageURL=""
      var x;
      var firstnamedata;
      var lastnamedata;
      var maildata;
      var numdata;
      var cardimageurl;
      var validPhotoData;
      var selectedrow;
      var imageurl;
      var error1=document.getElementById("error-msg");
      var error2=document.getElementById("error-msg1");
      var error3=document.getElementById("error-msg2");
      var error4=document.getElementById("error-msg3");
      var error5=document.getElementById("error-msg4");
      
      var currentURL = window.location.href;
      var navLink = document.querySelector('a');

      if (navLink.href === currentURL) {
        navLink.classList.add('Home-link-active'); 
      }  

      function firstnamevalid(event){
        event.preventDefault();
      if(!firstname.value){
        error1.textContent="Field Should not be Empty";
        firstnamedata=false;
      }else {
         firstnamedata = true;
         error1.textContent = "";
        }
      }

      function lastnamevalid(event){
        event.preventDefault();
      if(!lastname.value){
        error2.textContent="Field Should not be Empty";
        lastnamedata=false;
      }else {
         lastnamedata = true;
         error2.textContent = "";
        }
      }

      function emailvalid(event){
        event.preventDefault();
      if(!mail.value){
        error3.textContent="Field Should not be Empty";
        maildata=false;
      }
      else if(!mail.value.match(/^[A-Za-z\._\-0-9]*[@][A-Za-z]*[\.][a-z]{2,4}$/)){
        error3.textContent="Please Enter a valid Email";
        maildata=false;
      }
      else {
         maildata = true;
         error3.textContent = "";
        }
      }

      function phone(event){
        event.preventDefault();
      if(!num.value){
        error4.textContent="Field Should not be Empty";
        numdata=false;
      }else if(!num.value.match(/^\d{10}$/)){
        error4.textContent="Please Enter a valid Phone number";
        numdata=false;
      }
      else {
         numdata = true;
         error4.textContent = "";
        }
      }

      // var searchInput = document.getElementById("searchInput");

      //   // Add an input event listener to trigger search
      //   searchInput.addEventListener("input", function() {
      //       var searchTerm = searchInput.value.trim().toLowerCase();
      //       var rows = databody.getElementsByTagName("tr");
      //       console.log(rows);
      //       // Loop through rows starting from the second row (index 1)
      //       for (var i = 1; i < rows.length; i++) {
      //           var row = rows[i];
      //           console.log(row);
      //           var cells = row.getElementsByTagName("td");
      //           var rowMatch = false;
                
      //           if (searchTerm === "") {
      //               row.classList.remove("highlight");
      //           } else {
      //               for (var j = 1; j < cells.length; j++) {
      //                   var cell = cells[j];
      //                   var cellText = cell.textContent.trim().toLowerCase();
                        
      //                   // If a match is found, highlight the row and break
      //                   if (cellText.includes(searchTerm)) {
      //                       rowMatch = true;
      //                       break;
      //                   }
      //               }

      //               // Apply or remove the highlight class based on the match status
      //               if (rowMatch) {
      //                   row.classList.add("highlight");
      //                   console.log(row.classList.add("highlight"));
      //               } else {
      //                   row.classList.remove("highlight");
      //               }
      //           }
      //       }
      //   });
      var searchInput = document.getElementById("searchInput");
        
        var noDataFound = document.getElementById("noDataFound");

         searchInput.addEventListener("keyup", function() {
            var searchText = searchInput.value.toLowerCase();
            var rows = databody.getElementsByTagName("tr");
            var firstrow = document.getElementById("tr");

            var found = false;

            for (var i = 1; i < rows.length; i++) { // Start from 1 to skip the header row
                var row = rows[i];
                var shouldDisplay = false;

                var cells = row.getElementsByTagName("td");
                
                for (var j = 0; j < cells.length; j++) {
                    var cell = cells[j];
                    if (cell.textContent.toLowerCase().indexOf(searchText) > -1) {
                        shouldDisplay = true;
                        found = true;
                        break;
                    }
                }

                row.style.display = shouldDisplay ? "" : "none";
            }

            // Display "No data found" message if no matching rows were found
            noDataFound.style.display = found ? "none" : "block";
            // firstrow.style.display=found?"none":"block";
        });
      function deleteData(button) {
            console.log(button.parentNode.parentNode.parentNode);
            let row = button.parentNode.parentNode.parentNode;
            row.parentNode.removeChild(row);
            console.log(row);
        }

        function editData(td){
         selectedrow = td.parentNode.parentNode;
        //  console.log(selectedrow = td.parentNode.parentNode.rowIndex);
        //  console.log(selectedrow.cells[0]);
         document.querySelector(".popup").classList.add("active");
         firstname.value = selectedrow.cells[1].innerHTML; 
         lastname.value =  selectedrow.cells[2].innerHTML;
         mail.value = selectedrow.cells[3].innerHTML;
         num.value = selectedrow.cells[4].innerHTML;
         previewImage.src=images[(td.parentNode.parentNode.rowIndex-1)/2];
         cardImageURL=images[(td.parentNode.parentNode.rowIndex-1)/2];
         console.log(images[(td.parentNode.parentNode.rowIndex-1)/2]);

        //  previewImage.innerHTML=`<img src="${previewImage1}" alt="Image Preview" id="preview-image1"><br>`
        //  previewImage.src=imageu.src;
         document.querySelector(".btn1").classList.add("unactive");
         document.querySelector(".btn2").classList.add("active");
         document.querySelector(".popup .close-btn").addEventListener("click",function(){
         document.querySelector(".btn1").classList.remove("unactive");
         document.querySelector(".btn2").classList.remove("active");
         document.querySelector(".popup").classList.remove("active");
           });
        }

        function updatedata(){
          selectedrow.cells[0].innerHTML = `<img src="${cardimageurl}" alt="image" id="image8">`
          selectedrow.cells[1].innerHTML = firstname.value;
          selectedrow.cells[2].innerHTML = lastname.value;
          selectedrow.cells[3].innerHTML = mail.value ;
          selectedrow.cells[4].innerHTML = num.value ;
          document.querySelector(".popup").classList.remove("active");
          document.querySelector(".btn1").classList.remove("unactive");
          document.querySelector(".btn2").classList.remove("active");
          // clearErrors();
          clearInputs();
        }
        function clearInputs() {
          document.getElementById("firstname").value = "";
          document.getElementById("lastname").value = "";
          document.getElementById("email").value = "";
          document.getElementById("phone").value = "";
          document.getElementById("image-input").value = "";
          imagePreview.src = "";
          // validfirstnamedata = false;
          // validlastnamedata = false;
          // validemaildata = false;
          // validPhoneData = false;
          // validPhotoData = false;
          firstnamemgs.textContent = "";
          lastnamemgs.textContent = "";
          phonemgs.textContent = "";
          photomgs.textContent = "";
          emailmgs.textContent = "";

        }
        function clearErrors() {
            error1.textContent = "";
            error2.textContent = "";
            error3.textContent= "";
            error4.textContent = "";
            error5.textContent = "";
        }
       function validation(event){
        event.preventDefault();
        document.querySelector(".popup").classList.add("active");
         document.querySelector(".popup .close-btn").addEventListener("click",function(){
         clearInputs();
         clearErrors();
         document.querySelector(".popup").classList.remove("active");
           });
          }
  
    imageUpload.addEventListener('change', function () {
        const file = this.files[0];
    if (file) {   
      imageurl=URL.createObjectURL(file);
      previewImage.src=imageurl;
      cardimageurl=imageurl;
      // cardImageURL=images[(td.parentNode.parentNode.rowIndex-1)/2];
      console.log(imageurl)
      images.push(imageurl);
       console.log(images);
      previewImage.style.display = 'block';
      validPhotoData = true;
      error5.textContent = "";
    } else {
        previewImage.src = "";
        validPhotoData = false;
        error5.textContent = "This field is required";
    }
    });


     submit.addEventListener("click", (e)=>{
     e.preventDefault()
    if(firstnamedata && lastnamedata  && maildata && numdata && validPhotoData){
      e.preventDefault();
        databody.innerHTML += `
        <tr id="tr">
                <th>Profile</th>
                <th>Frist Name</th>
                <th>Last Name</th>
                <th>E-mail</th>
                <th>Mobile Number</th>
                <th>Actions</th>
            </tr>
        <tr>
        <td  data-title="Profile"><img src="${cardimageurl}" alt="image" id="image8"></td>
        <td data-title="FristName">${firstname.value}</td>
        <td  data-title="LastName">${lastname.value}</td>
        <td  data-title="Email">${mail.value}</td>
        <td  data-title="Phone number">${num.value}</td>
        <td  data-title="Actions"><input type="button" id="edit-btn" value="Edit" onclick="editData(this)">&nbsp<input type="button" id="delete-btn" value="Delete" onclick="deleteData(this)"></td>
        </tr>`
      
       document.querySelector(".popup").classList.remove("active")
       clearInputs();
       clearErrors();
    }
    else if(firstnamedata){
      error2.textContent="Field is required";
      error3.textContent="Field is required";
      error4.textContent="Field is required";
      error5.textContent="Field is required";
    }
    else if(lastnamedata){
      error1.textContent="Field is required";
      error3.textContent="Field is required";
      error4.textContent="Field is required";
      error5.textContent="Field is required";
    }
    else if(maildata){
      error1.textContent="Field is required";
      error2.textContent="Field is required";
      error4.textContent="Field is required";     
      error5.textContent="Field is required";
    }
    else if(numdata){
      error1.textContent="Field is required";
      error2.textContent="Field is required";
      error3.textContent="Field is required";
      error5.textContent="Field is required";
    }
    else if(validPhotoData){
      error1.textContent="Field is required";
      error2.textContent="Field is required";
      error3.textContent="Field is required";
      error4.textContent="Field is required";
    }
   else{
    error1.textContent="Field is required";
    error2.textContent="Field is required";
    error3.textContent="Field is required";
    error4.textContent="Field is required";
    error5.textContent="Field is required";
   }
})
    </script>
</body>
</html>
